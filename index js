let player;
let watchSeconds = 0;
let watchInterval;
let videoId;

// Get YouTube video ID from ?video= in URL
const urlParams = new URLSearchParams(window.location.search);
videoId = urlParams.get("video");

if (!videoId) {
  document.getElementById("timer").textContent = "No video selected.";
}

// YouTube API callback
function onYouTubeIframeAPIReady() {
  if (videoId) {
    player = new YT.Player("player", {
      height: "270",
      width: "480",
      videoId: videoId,
      playerVars: {
        autoplay: 0,
        controls: 1,
        enablejsapi: 1
      },
      events: {
        onStateChange: onPlayerStateChange
      }
    });
  }
}

// Track watch time
function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    if (!watchInterval) {
      watchInterval = setInterval(() => {
        watchSeconds++;
        document.getElementById("timer").textContent = `Watch Time: ${watchSeconds} seconds`;
      }, 1000);
    }
  } else {
    clearInterval(watchInterval);
    watchInterval = null;
  }
}
